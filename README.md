# Hides Luxury Receipt Generator API

## Overview
A high-performance application focused on automatically generating 
professional digital receipts after a successful order is placed on an eâ€‘commerce platform built with Node.js and Express. It utilizes BullMQ for distributed task processing to handle PDF generation and email dispatch asynchronously, ensuring non-blocking API performance.

## Features
- **Node.js & Express**: Core API architecture for high-concurrency request handling.
- **BullMQ & Redis**: Reliable background job processing for PDF generation and email delivery.
- **PDFKit**: Programmatic generation of high-quality, professional e-commerce receipts.
- **Cloudinary Integration**: Secure cloud storage for generated PDF assets with signed URL support.
- **Nodemailer**: Automated SMTP integration for real-time customer receipt delivery.
- **Mongoose**: Robust data modeling and persistence for orders and receipt records.

## Getting Started
### Installation
1. Clone the repository:
   ```bash
   git clone <repository-url>
   ```
2. Install dependencies:
   ```bash
   npm install
   ```
3. Start the Redis server (required for BullMQ).
4. Run the API server:
   ```bash
   npm run dev
   ```
5. Run the worker process in a separate terminal:
   ```bash
   npm run worker
   ```

### Environment Variables
Create a `.env` file in the root directory and include the following:
```env
PORT=4000
CONNECTION_STRING=mongodb+srv://<user>:<password>@cluster.mongodb.net/dbname
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password
EMAIL_FROM=noreply@hidesluxury.com
```

## API Documentation
### Base URL
`http://localhost:4000/api`

### Endpoints

#### POST /payments/simulate
**Request**:
```json
{
  "orderId": "ORD-9921",
  "customerName": "Jane Doe",
  "customerEmail": "jane@example.com",
  "items": [
    { "name": "Leather Handbag", "quantity": 1, "price": 250.00 }
  ],
  "subtotal": 250.00,
  "tax": 25.00,
  "discount": 10.00,
  "total": 265.00,
  "paymentMethod": "Credit Card"
}
```

**Response**:
```json
{
  "message": "Payment simulated successfully",
  "orderId": "ORD-9921"
}
```

**Errors**:
- 400: Missing required fields (orderId, customerEmail, total)
- 400: Order with this orderId already exists
- 500: Internal server error during payment simulation

#### POST /receipts/generate-receipt
**Request**:
```json
{
  "orderId": "ORD-9921"
}
```

**Response**:
```json
{
  "message": "Receipt generated and emailed successfully",
  "receiptUrl": "https://res.cloudinary.com/..."
}
```

**Errors**:
- 400: orderId is required
- 404: Order not found
- 500: Failed to generate or upload receipt

#### GET /receipts/:orderId
**Request**:
URL Parameter: `orderId` (string)

**Response**:
```json
{
  "receiptId": "R-ORD-9921",
  "orderId": "ORD-9921",
  "customerEmail": "jane@example.com",
  "receiptUrl": "https://res.cloudinary.com/...",
  "createdAt": "2023-10-27T10:00:00.000Z"
}
```

**Errors**:
- 404: Receipt not found
- 500: Database connection error

## Technologies Used
| Technology | Purpose | Link |
| :--- | :--- | :--- |
| Node.js | Runtime Environment | [Link](https://nodejs.org/) |
| MongoDB | Database | [Link](https://www.mongodb.com/) |
| Redis | Message Broker | [Link](https://redis.io/) |
| BullMQ | Task Queue | [Link](https://docs.bullmq.io/) |
| Cloudinary | Asset Management | [Link](https://cloudinary.com/) |
| PDFKit | PDF Generation | [Link](https://pdfkit.org/) |

## Contributing
- Fork the repository and create your feature branch.
- Ensure all environment variables are configured in your local environment.
- Follow the existing architectural pattern (Controller-Service-Worker).
- Submit a pull request with a detailed description of changes.

## Author Info
- **Ibrahim Adegboye**
- [LinkedIn](https://linkedin.com/in/)
- [Twitter](https://twitter.com/)
- [Portfolio](https://)

---
![NodeJS](https://img.shields.io/badge/Node.js-339933?style=for-the-badge&logo=nodedotjs&logoColor=white)
![Express](https://img.shields.io/badge/Express.js-000000?style=for-the-badge&logo=express&logoColor=white)
![MongoDB](https://img.shields.io/badge/MongoDB-47A248?style=for-the-badge&logo=mongodb&logoColor=white)
![Redis](https://img.shields.io/badge/redis-%23DD0031.svg?style=for-the-badge&logo=redis&logoColor=white)

[![Readme was generated by Dokugen](https://img.shields.io/badge/Readme%20was%20generated%20by-Dokugen-brightgreen)](https://www.npmjs.com/package/dokugen)